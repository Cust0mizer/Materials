[[Разрешения Android]]

Окно можно вывести с помощью следующего класса с методом:

```csharp
    public static class AndroidNotificationWindow {
        public static void Show() {
            using (AndroidJavaClass unityPlayer = new AndroidJavaClass("com.unity3d.player.UnityPlayer")) {
                AndroidJavaObject currentActivity = unityPlayer.GetStatic<AndroidJavaObject>("currentActivity");

                // Проверка разрешения
                AndroidJavaObject contextCompat = new AndroidJavaClass("androidx.core.content.ContextCompat");
                int permissionCheck = contextCompat.CallStatic<int>("checkSelfPermission", currentActivity, "android.permission.POST_NOTIFICATIONS");

                // Если разрешение не предоставлено
                if (permissionCheck != 0) {
                    AndroidJavaObject activityCompat = new AndroidJavaClass("androidx.core.app.ActivityCompat");
                    activityCompat.CallStatic("requestPermissions", currentActivity, new string[] { "android.permission.POST_NOTIFICATIONS" }, 0);
                }
            }
        }
    }
```

разберем его подробно




Этот класс на C# предназначен для использования в Unity, чтобы проверять и запрашивать разрешение на отправку уведомлений в Android-приложении. Вот подробное объяснение его работы:

### Назначение класса

Класс `AndroidNotificationWindow` предоставляет функционал для отображения уведомлений в приложении, используя стандартные классы Android, вызванные через C#. Он использует AndroidJNI (Java Native Interface) в Unity для взаимодействия с Java-классами Android. Конкретно метод `Show` проверяет, есть ли у приложения разрешение на отправку уведомлений (`POST_NOTIFICATIONS`). Если разрешение отсутствует, метод запрашивает его у пользователя.

### Разбор кода класса

1. **Класс и метод `Show`**
    
    csharp
    
    Копировать код
    
    `public static class AndroidNotificationWindow {     public static void Show() { ... } }`
    
    - `AndroidNotificationWindow`: это статический класс, поэтому его нельзя создавать как объект. Он нужен исключительно для вызова `Show` без создания экземпляра.
    - `Show`: статический метод, который выполняет проверку и запрос разрешений. Обычно этот метод вызывается, когда приложение хочет запросить разрешение на отправку уведомлений, например, при первом запуске или при необходимости отправки уведомления пользователю.
2. **Доступ к активности Unity**
    
    csharp
    
    Копировать код
    
    `using (AndroidJavaClass unityPlayer = new AndroidJavaClass("com.unity3d.player.UnityPlayer")) {     AndroidJavaObject currentActivity = unityPlayer.GetStatic<AndroidJavaObject>("currentActivity"); }`
    
    - `AndroidJavaClass` и `AndroidJavaObject` — классы Unity для взаимодействия с Java через JNI.
    - `unityPlayer` ссылается на класс `com.unity3d.player.UnityPlayer` — стандартный класс Unity на Android, который управляет активностью приложения.
    - `currentActivity` получает ссылку на текущую активность приложения (Activity), чтобы далее вызывать Android-методы, связанные с уведомлениями и разрешениями.
3. **Проверка разрешения**
    
    csharp
    
    Копировать код
    
    `AndroidJavaObject contextCompat = new AndroidJavaClass("androidx.core.content.ContextCompat"); int permissionCheck = contextCompat.CallStatic<int>("checkSelfPermission", currentActivity, "android.permission.POST_NOTIFICATIONS");`
    
    - `ContextCompat`: класс из библиотеки AndroidX, который помогает управлять контекстами и разрешениями.
    - `checkSelfPermission`: метод, проверяющий, предоставлено ли конкретное разрешение для приложения.
    - `permissionCheck` получает значение 0, если разрешение уже предоставлено, и ненулевое значение, если разрешение отсутствует.
4. **Запрос разрешения**
    
    csharp
    
    Копировать код
    
    `if (permissionCheck != 0) {     AndroidJavaObject activityCompat = new AndroidJavaClass("androidx.core.app.ActivityCompat");     activityCompat.CallStatic("requestPermissions", currentActivity, new string[] { "android.permission.POST_NOTIFICATIONS" }, 0); }`
    
    - Если `permissionCheck` не равен нулю (то есть разрешение отсутствует), то создается объект `ActivityCompat` для запроса разрешения у пользователя.
    - `requestPermissions`: метод, который вызывает окно запроса разрешений для пользователя, предлагая разрешить отправку уведомлений. Аргументы:
        - `currentActivity`: текущая активность приложения.
        - `new string[] { "android.permission.POST_NOTIFICATIONS" }`: массив строк с требуемыми разрешениями (здесь только `POST_NOTIFICATIONS`).
        - `0`: код запроса, который можно использовать для идентификации этого запроса, если требуется обработать результат.

### Итог

`AndroidNotificationWindow` — это небольшой, но полезный класс, выполняющий проверку и запрос разрешений на отправку уведомлений. Этот класс помогает приложению соответствовать требованиям Android к обработке разрешений, улучшая взаимодействие с пользователем.